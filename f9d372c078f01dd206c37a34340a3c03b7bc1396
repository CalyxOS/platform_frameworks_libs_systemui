{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "6605326e_0ab4a702",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-01-11T21:03:24Z",
      "side": 1,
      "message": "The story here: Google majorly refactored iconloaderlib, which now includes its own copy of the briefcase icon (which is always blue) and only considers whether an icon should have a work badge or not via a flag. The user is not taken into account at all. There\u0027s no single commit to revert, because so much has changed.\n\nThis adds user into the mix, and uses the same PackageManager calls as before, which are still used by SystemUI for example (notification area). However, all of the refactoring expects to be able to use the badge separate from the icon, and PackageManager just wants to give you a badged app icon (all-in-one). PackageManager doesn\u0027t expose a usable way to get *just* the badge itself, which is what this refactored iconloaderlib needs. The closest method available doesn\u0027t actually work because the scale is wrong, and I couldn\u0027t fix that.\n\nSo, this doesn\u0027t do the prettiest thing: it asks PackageManager to place the badge on top of an empty canvas instead of an actual app icon, and then it crops to the badge.\n\nI\u0027ve been using this on my daily driver for at least a few weeks and it\u0027s been working fine.",
      "revId": "f9d372c078f01dd206c37a34340a3c03b7bc1396",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "776052f4_260c7caa",
        "filename": "iconloaderlib/src/com/android/launcher3/icons/BaseIconFactory.java",
        "patchSetId": 1
      },
      "lineNbr": 440,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-01-11T21:15:30Z",
      "side": 1,
      "message": "`assert` might be extreme. It\u0027s here because we expect that whatever badge size is requested is going to be smaller than an icon size, and we don\u0027t account for other circumstances.",
      "revId": "f9d372c078f01dd206c37a34340a3c03b7bc1396",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e0e192e8_f086db7e",
        "filename": "iconloaderlib/src/com/android/launcher3/icons/BaseIconFactory.java",
        "patchSetId": 1
      },
      "lineNbr": 440,
      "author": {
        "id": 1000075
      },
      "writtenOn": "2023-01-12T12:21:35Z",
      "side": 1,
      "message": "Couldn\u0027t `assert` calls be optimized out?\nWouldn\u0027t it be better to use an `if`, which throws an exception, instead?",
      "parentUuid": "776052f4_260c7caa",
      "revId": "f9d372c078f01dd206c37a34340a3c03b7bc1396",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d7081e06_6a335758",
        "filename": "iconloaderlib/src/com/android/launcher3/icons/BaseIconFactory.java",
        "patchSetId": 1
      },
      "lineNbr": 440,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-01-19T14:03:25Z",
      "side": 1,
      "message": "Thanks, yes, that would be better, or maybe just logging an error. Although we don\u0027t account for it, things shouldn\u0027t necessarily crash just because of it. Guess I should test it artificially.",
      "parentUuid": "e0e192e8_f086db7e",
      "revId": "f9d372c078f01dd206c37a34340a3c03b7bc1396",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "545d8fcf_5f7ed04a",
        "filename": "iconloaderlib/src/com/android/launcher3/icons/BaseIconFactory.java",
        "patchSetId": 1
      },
      "lineNbr": 440,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-03-15T21:53:31Z",
      "side": 1,
      "message": "Changed to an exception now. Didn\u0027t test it artificially because... why would the badge ever be bigger than the icon anyway? [famous last words]",
      "parentUuid": "d7081e06_6a335758",
      "revId": "f9d372c078f01dd206c37a34340a3c03b7bc1396",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8ed78991_55940b9f",
        "filename": "iconloaderlib/src/com/android/launcher3/icons/BitmapInfo.java",
        "patchSetId": 1
      },
      "lineNbr": 118,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-01-11T21:10:23Z",
      "side": 1,
      "message": "It makes sense that if you can setUser(), you should be able to getUser(). That\u0027s why this is here. But in reality, all we use it for is to figure out what icon to use, and then we don\u0027t need it anymore. So technically, if we wanted, we could remove mUserHandle and getUser(), too, and nothing would change, for our purposes.",
      "revId": "f9d372c078f01dd206c37a34340a3c03b7bc1396",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "578c2a71_5416eee4",
        "filename": "iconloaderlib/src/com/android/launcher3/icons/BitmapInfo.java",
        "patchSetId": 1
      },
      "lineNbr": 118,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-03-15T21:53:31Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "8ed78991_55940b9f",
      "revId": "f9d372c078f01dd206c37a34340a3c03b7bc1396",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ac9b9fda_00ab5978",
        "filename": "iconloaderlib/src/com/android/launcher3/icons/BitmapInfo.java",
        "patchSetId": 1
      },
      "lineNbr": 121,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-01-11T21:10:23Z",
      "side": 1,
      "message": "It looks weird leaving commented code in here, but as with the other commented code section (which contains getUserBadgedDrawableForDensity), I left it in, in case it is useful in the event that AOSP changes something and we suddenly need to do something differently. In my testing though, it doesn\u0027t seem to be necessary now.",
      "revId": "f9d372c078f01dd206c37a34340a3c03b7bc1396",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "69e98fd0_058f4a4f",
        "filename": "iconloaderlib/src/com/android/launcher3/icons/BitmapInfo.java",
        "patchSetId": 1
      },
      "lineNbr": 121,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2023-03-15T21:53:31Z",
      "side": 1,
      "message": "Ack, I think it\u0027s fine",
      "parentUuid": "ac9b9fda_00ab5978",
      "revId": "f9d372c078f01dd206c37a34340a3c03b7bc1396",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    }
  ]
}